---
import Layout from '../layouts/Layout.astro';
---

<Layout title="Create Room - Pantry Party">
  <div class="max-w-2xl mx-auto">
    <h1 class="text-4xl font-bold text-gray-900 mb-8">Create a New Room</h1>
    
    <div class="bg-white p-8 rounded-lg shadow-md">
      <form id="create-room-form" class="space-y-6">
        <div>
          <label for="owner-name" class="block text-sm font-medium text-gray-700 mb-2">
            Your Name
          </label>
          <input
            type="text"
            id="owner-name"
            name="ownerName"
            required
            class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent"
            placeholder="Enter your name"
          />
        </div>

        <button
          type="submit"
          class="w-full bg-primary-600 text-white py-3 px-6 rounded-lg font-semibold hover:bg-primary-700 transition"
        >
          Create Room
        </button>
      </form>

      <div id="room-link" class="mt-6 hidden">
        <div class="bg-green-50 border border-green-200 rounded-lg p-4">
          <p class="text-sm text-green-800 mb-2 font-semibold">Room created! Share this link:</p>
          <div class="flex gap-2">
            <input
              type="text"
              id="room-url"
              readonly
              class="flex-1 px-4 py-2 bg-white border border-green-300 rounded-lg text-sm"
            />
            <button
              id="copy-link"
              class="bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 transition"
            >
              Copy
            </button>
          </div>
          <a
            id="enter-room"
            href="#"
            class="inline-block mt-4 bg-primary-600 text-white px-6 py-2 rounded-lg hover:bg-primary-700 transition"
          >
            Enter Room â†’
          </a>
        </div>
      </div>
    </div>
  </div>
</Layout>

<script>
  // This would integrate with Convex in production
  document.getElementById('create-room-form')?.addEventListener('submit', async (e) => {
    e.preventDefault();
    const form = e.target as HTMLFormElement;
    const ownerName = (form.elements.namedItem('ownerName') as HTMLInputElement).value;
    
    // TODO: Call Convex mutation to create room
    // const roomId = await convex.mutation(api.rooms.createRoom, { ownerName });
    
    // Mock for now
    const roomId = 'mock-room-' + Date.now();
    const roomUrl = `${window.location.origin}/room/${roomId}`;
    
    document.getElementById('room-url')!.setAttribute('value', roomUrl);
    document.getElementById('enter-room')!.setAttribute('href', `/room/${roomId}`);
    document.getElementById('room-link')!.classList.remove('hidden');
  });

  document.getElementById('copy-link')?.addEventListener('click', () => {
    const input = document.getElementById('room-url') as HTMLInputElement;
    input.select();
    navigator.clipboard.writeText(input.value);
    
    const button = document.getElementById('copy-link')!;
    button.textContent = 'Copied!';
    setTimeout(() => {
      button.textContent = 'Copy';
    }, 2000);
  });
</script>
